<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculadora de Comisiones ONCE 2025</title>
  <meta name="theme-color" content="#1e1e1e">
  <style>
    :root{
      --bg:#ffffff; --fg:#111111; --card:#f5f5f5; --primary:#0d6efd; --ok:#198754; --warn:#ffc107; --bad:#dc3545;
    }
    [data-theme="dark"]{
      --bg:#121212; --fg:#f0f0f0; --card:#1e1e1e; --primary:#62a7ff; --ok:#5ddf9a; --warn:#ffe27a; --bad:#ff8b94;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,sans-serif;background:var(--bg);color:var(--fg)}
    header{display:flex;gap:.75rem;align-items:center;justify-content:space-between;padding:1rem;position:sticky;top:0;background:var(--bg)}
    h1{font-size:1.1rem;margin:0}
    main{max-width:760px;margin:0 auto;padding:1rem;display:grid;gap:1rem}
    .card{background:var(--card);border-radius:12px;padding:1rem}
    label{display:block;font-weight:600;margin:.35rem 0}
    input,select,button{width:100%;padding:.7rem .8rem;border-radius:10px;border:1px solid #00000022;background:#fff}
    [data-theme="dark"] input,[data-theme="dark"] select,[data-theme="dark"] button{background:#111;border-color:#ffffff22;color:var(--fg)}
    .grid{display:grid;gap:.75rem}
    @media(min-width:720px){ .grid{grid-template-columns:1fr 1fr} }
    .row{display:grid;grid-template-columns:1fr 1fr;gap:.75rem}
    .actions{display:flex;gap:.5rem;flex-wrap:wrap}
    button.primary{background:var(--primary);color:#fff;border:none}
    .pill{display:inline-block;padding:.25rem .6rem;border-radius:999px;font-size:.85rem}
    .ok{background:color-mix(in srgb, var(--ok) 20%, transparent);border:1px solid var(--ok);color:var(--ok)}
    .warn{background:color-mix(in srgb, var(--warn) 20%, transparent);border:1px solid var(--warn);color:#8a6a00}
    .bad{background:color-mix(in srgb, var(--bad) 20%, transparent);border:1px solid var(--bad);color:#7a1a20}
    .muted{opacity:.85}
    .kpi{font-size:1.1rem;margin:.25rem 0}
    .mono{font-variant-numeric:tabular-nums}
    .right{display:flex;gap:.5rem;align-items:center}
  </style>
</head>
<body>
  <header>
    <h1>Calculadora de Comisiones ONCE 2025</h1>
    <div class="right">
      <button id="btnTema" title="Cambiar tema">üåó Tema</button>
    </div>
  </header>

  <main>
    <section class="card grid">
      <div>
        <label for="tipo">Tipo de producto</label>
        <select id="tipo">
          <option value="diario">Diario</option>
          <option value="cuponazo">Cuponazo</option>
          <option value="sueldazo">Sueldazo</option>
          <option value="rasca">Rasca</option>
          <option value="triplex">Triplex</option>
          <option value="superonce">Super Once</option>
          <option value="midia">Mi D√≠a</option>
          <option value="eurojackpot">Eurojackpot</option>
          <option value="extraordinario">Extraordinario</option>
          <option value="resto">Otros</option>
        </select>
      </div>

      <div>
        <label for="jornadas">Jornadas trabajadas (1‚Äì26)</label>
        <input id="jornadas" type="number" min="1" max="26" value="20" />
        <div class="muted" style="margin-top:.25rem">Se usan <b>Umbral=210‚Ç¨√ójornadas</b> y <b>M√≠nimo=142‚Ç¨√ójornadas</b>.</div>
      </div>

      <div>
        <label for="vendidos">Unidades vendidas</label>
        <input id="vendidos" type="number" min="0" value="0" />
      </div>

      <div>
        <label for="precio">Precio por unidad (‚Ç¨)</label>
        <input id="precio" type="number" step="0.01" min="0" value="2" />
        <div class="muted" style="margin-top:.25rem">Se autocompleta por producto, pero puedes cambiarlo.</div>
      </div>

      <div class="actions" style="grid-column:1/-1">
        <button class="primary" id="btnCalc">üî¢ Calcular</button>
        <button id="btnReset">üßπ Limpiar</button>
      </div>
    </section>

    <section id="out" class="card">
      <div class="muted">Introduce datos y pulsa ‚ÄúCalcular‚Äù.</div>
    </section>
  </main>

  <script>
    // ======= Config =======
    const precios = {
      diario:2, cuponazo:3, sueldazo:2,
      rasca:1, triplex:0.5, superonce:1, midia:1, eurojackpot:2,
      extraordinario:2.5, resto:1.5
    };

    // % de comisi√≥n por producto cuando se supera umbral (ajusta si cambian)
    const porcentajes = {
      diario:0.077, cuponazo:0.077, sueldazo:0.077,
      rasca:0.065, triplex:0.05, superonce:0.05, midia:0.05, eurojackpot:0.05,
      extraordinario:0.10, resto:0.04
    };

    // ======= UI helpers =======
    const $ = s => document.querySelector(s);
    const fmt = n => (isNaN(n) ? "-" : n.toLocaleString("es-ES",{minimumFractionDigits:2, maximumFractionDigits:2}));

    // Tema
    const aplicarTema = t => document.documentElement.setAttribute("data-theme", t);
    const cargarTema = () => localStorage.getItem("tema") || (window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark":"light");
    const guardarTema = t => localStorage.setItem("tema", t);

    // ======= L√≥gica =======
    function autocompletarPrecio(){
      const tipo = $("#tipo").value;
      if (precios[tipo] != null) $("#precio").value = precios[tipo];
    }

    function calcular(){
      const tipo = $("#tipo").value;
      const jornadas = Math.max(1, Math.min(26, parseInt($("#jornadas").value||"0")));
      const vendidos = Math.max(0, parseInt($("#vendidos").value||"0"));
      const precio = Math.max(0, parseFloat($("#precio").value||"0"));

      // Importe vendido
      const total = vendidos * precio;

      // Tabla oficial lineal: Umbral=210‚Ç¨/jornada, M√≠nimo=142‚Ç¨/jornada
      const umbral = jornadas * 210;
      const minimo = jornadas * 142;

      // Comisi√≥n solo si se supera el umbral
      const pct = porcentajes[tipo] ?? 0;
      const comision = total >= umbral ? total * pct : 0;

      // Sem√°foro
      let pill = `<span class="pill bad">‚ùå No alcanzado el m√≠nimo</span>`;
      if (total >= umbral) pill = `<span class="pill ok">‚úÖ Superado el umbral</span>`;
      else if (total >= minimo) pill = `<span class="pill warn">‚ö†Ô∏è Entre m√≠nimo y umbral (sin comisi√≥n)</span>`;

      $("#out").innerHTML = `
        <div class="kpi">üßæ <b>${vendidos}</b> unidades √ó <b>${fmt(precio)} ‚Ç¨</b> = <b class="mono">${fmt(total)} ‚Ç¨</b></div>
        <div class="kpi">üìÖ Jornadas: <b>${jornadas}</b> ‚Üí M√≠nimo: <b class="mono">${fmt(minimo)} ‚Ç¨</b> | Umbral: <b class="mono">${fmt(umbral)} ‚Ç¨</b></div>
        <div class="kpi">üìà Comisi√≥n aplicada: <b>${(pct*100).toFixed(1)}%</b></div>
        <div class="kpi">üí∞ Ganancia estimada: <b class="mono">${fmt(comision)} ‚Ç¨</b></div>
        <div style="margin-top:.5rem">${pill}</div>
        <div class="muted" style="margin-top:.5rem">Nota: la comisi√≥n se calcula al superar el umbral de ${fmt(umbral)} ‚Ç¨.</div>
      `;
    }

    function reset(){
      $("#vendidos").value = 0;
      autocompletarPrecio();
      $("#out").innerHTML = `<div class="muted">Introduce datos y pulsa ‚ÄúCalcular‚Äù.</div>`;
    }

    // ======= Eventos =======
    $("#tipo").addEventListener("change", autocompletarPrecio);
    $("#btnCalc").addEventListener("click", calcular);
    $("#btnReset").addEventListener("click", reset);

    // Tema
    const temaInicial = cargarTema();
    aplicarTema(temaInicial);
    $("#btnTema").addEventListener("click", () => {
      const nuevo = (document.documentElement.getAttribute("data-theme") === "dark") ? "light" : "dark";
      aplicarTema(nuevo); guardarTema(nuevo);
    });

    // Precarga precio correcto
    autocompletarPrecio();

    // ======= PWA (opcional; silencioso si no existen archivos) =======
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("./service-worker.js").catch(() => {});
      });
    }
  </script>
</body>
</html>
