<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calculadora de Comisiones ONCE 2025</title>
  <meta name="theme-color" content="#d62828">
  <link rel="icon" type="image/png" href="https://placehold.co/192x192/d62828/ffffff?text=ONCE" sizes="192x192">
  <style>
    :root {
      --bg: #ffffff;
      --fg: #000000;
      --primary: #d62828;
      --secondary: #fcbf49;
      --accent: #003049;
    }
    [data-theme="dark"] {
      --bg: #1e1e1e;
      --fg: #f0f0f0;
      --primary: #ff595e;
      --secondary: #ffca3a;
      --accent: #8ac926;
    }
    body {
      font-family: Arial, sans-serif;
      background: var(--bg);
      color: var(--fg);
      margin: 0;
      padding: 1rem;
    }
    h1 {
      color: var(--primary);
    }
    select, input[type=number], button {
      width: 100%;
      padding: 0.5rem;
      margin: 0.5rem 0;
      font-size: 1rem;
    }
    .resultado, .semana, .resumen-mensual, .historial-ventas, .grafico-container {
      margin-top: 1rem;
      background: var(--secondary);
      color: var(--accent);
      padding: 1rem;
      border-radius: 8px;
    }
    .alerta {
      font-weight: bold;
      padding: 0.5rem;
      margin-top: 0.5rem;
      border-radius: 5px;
    }
    .verde { background: #d4edda; color: #155724; }
    .naranja { background: #fff3cd; color: #856404; }
    .rojo { background: #f8d7da; color: #721c24; }
    canvas {
      width: 100% !important;
      height: auto !important;
    }
    #toggleTema {
      background: var(--accent);
      color: var(--bg);
      border: none;
      cursor: pointer;
      padding: 0.5rem;
      margin-bottom: 1rem;
    }
  </style>
</head>
<body>
  <h1>Calculadora de Comisiones ONCE 2025</h1>
  <button id="toggleTema" onclick="cambiarTema()">üåó Cambiar tema</button>
  <button onclick="iniciarReconocimientoVoz()">üéôÔ∏è Dictar ventas</button>
  <label>Tipo de producto:
    <select id="tipo" onchange="autocompletarPrecio()">
      <option value="diario">Diario</option>
      <option value="cuponazo">Cuponazo</option>
      <option value="sueldazo">Sueldazo</option>
      <option value="rasca">Rasca</option>
      <option value="triplex">Triplex</option>
      <option value="superonce">Super Once</option>
      <option value="midia">Mi D√≠a</option>
      <option value="eurojackpot">Eurojackpot</option>
      <option value="extraordinario">Extraordinario</option>
      <option value="resto">Otros</option>
    </select>
  </label>
  <label>D√≠as trabajados:
    <input id="dias" type="number" value="20" min="1" max="26">
  </label>
  <label>Cupones vendidos:
    <input id="vendidos" type="number" value="0" min="0">
  </label>
  <label>Precio por cup√≥n (‚Ç¨):
    <input id="precio" type="number" value="2" step="0.1">
  </label>
  <button onclick="calcularComision()">Calcular Comisi√≥n</button>
  <div class="resultado" id="resultado"></div>

  <script>
    const precios = {
      diario: 2, cuponazo: 3, sueldazo: 2, rasca: 1,
      triplex: 0.5, superonce: 1, midia: 1, eurojackpot: 2,
      extraordinario: 2.5, resto: 1.5
    };

    const porcentajes = {
      diario: 0.077, cuponazo: 0.077, sueldazo: 0.077,
      rasca: 0.065, triplex: 0.05, superonce: 0.05,
      midia: 0.05, eurojackpot: 0.05, extraordinario: 0.10, resto: 0.04
    };

    function autocompletarPrecio() {
      const tipo = document.getElementById("tipo").value;
      document.getElementById("precio").value = precios[tipo];
    }

    function calcularComision() {
      const tipo = document.getElementById("tipo").value;
      const dias = parseInt(document.getElementById("dias").value);
      const vendidos = parseInt(document.getElementById("vendidos").value);
      const precio = parseFloat(document.getElementById("precio").value);

      const total = vendidos * precio;
      const minimo = dias * precio * 71;
      const umbral = dias * precio * 105;
      let comision = 0;
      if (total >= umbral) comision = total * porcentajes[tipo];

      const alerta = total >= umbral ? 'verde' : total >= minimo ? 'naranja' : 'rojo';

      document.getElementById("resultado").innerHTML = `
        üî¢ Vendidos: ${vendidos} cupones √ó ${precio.toFixed(2)} ‚Ç¨ = ${total.toFixed(2)} ‚Ç¨<br>
        üìÖ D√≠as: ${dias} ‚Üí M√≠nimo: ${minimo.toFixed(2)} ‚Ç¨ | Umbral: ${umbral.toFixed(2)} ‚Ç¨<br>
        üìà Comisi√≥n: ${porcentajes[tipo]*100}%<br>
        üí∞ Ganancia estimada: ${comision.toFixed(2)} ‚Ç¨<br>
        <div class="alerta ${alerta}">${total >= umbral ? '‚úÖ Superado el umbral' : total >= minimo ? '‚ö†Ô∏è Superado el m√≠nimo, sin comisi√≥n' : '‚ùå No alcanzado el m√≠nimo'}</div>
      `;
    }

    function cambiarTema() {
      const html = document.documentElement;
      html.dataset.theme = html.dataset.theme === "dark" ? "light" : "dark";
    }

    const reconocimiento = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recogedor = reconocimiento ? new reconocimiento() : null;
    let estaReconociendo = false;

    function iniciarReconocimientoVoz() {
      if (!recogedor) return alert("Tu navegador no soporta voz.");
      if (estaReconociendo) return;
      recogedor.lang = "es-ES";
      recogedor.start();
    }

    if (recogedor) {
      recogedor.onstart = () => estaReconociendo = true;
      recogedor.onend = () => estaReconociendo = false;
      recogedor.onresult = e => {
        const texto = e.results[0][0].transcript.toLowerCase();
        const partes = texto.match(/(\d+)\s*cupon(?:es)?\s*(?:vendido|vendidos)?/);
        if (partes) document.getElementById("vendidos").value = partes[1];
      };
    }
  </script>
</body>
</html>
